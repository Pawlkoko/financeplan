<!DOCTYPE html>
<html data-wf-page="682b7e84a37f1c21053d0196" data-wf-site="682b7e84a37f1c21053d018d">

<head>
  <meta charset="utf-8">
  <title>FinanceDashboard</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/financedashboard.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <script>
    WebFont.load({ google: { families: ["Montserrat:100,900", "Inconsolata:400,700"] } });
  </script>
  <script>
    !function (o, c) {
      var n = c.documentElement, t = " w-mod-";
      n.className += t + "js";
      ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
    }(window, document);
  </script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>

<body>
  <section class="header_section">
    <div class="div-block-14">
      <h1 class="logo">FINANCEXPLANER</h1>
      <div class="text-block-3">USERNAME</div>
    </div>
  </section>
  <section class="tabs_section">
    <div class="tabs_wrapper">
      <div data-current="Tab 1" class="tabs w-tabs">
        <div class="tabs-menu w-tab-menu">
          <a data-w-tab="Tab 1" class="tab-link-tab-1 w-inline-block w-tab-link w--current">
            <div>Tab 1</div>
          </a>
          <a data-w-tab="Tab 2" class="tab-link-tab-2 w-inline-block w-tab-link">
            <div>Tab 2</div>
          </a>
          <a data-w-tab="Tab 3" class="tab-link-tab-3 w-inline-block w-tab-link">
            <div>Tab 3</div>
          </a>
        </div>
        <div class="tabs-content w-tab-content">
          <div data-w-tab="Tab 1" class="w-tab-pane w--tab-active">
            <section class="config-step-2" style="display: none;">
              <div class="prawiegotowewrapper">
                <h1 class="heading-4">Prawie gotowe...</h1>
                <p class="paragraph">Prawie gotowe! Teraz tylko powiąż bota z Twoim kontem klikając w ten link!</p>
                <div class="form-block">
                  <label><strong>Otwórz bota w telegramie:</strong></label>
                  <div class="div-block-16">
                    <a id="tg-button" class="submit-button w-button" target="_blank">Podłącz bota</a>
                  </div>
                </div>
              </div>
            </section>
            <section class="config-step-3" style="display: none;">
              <div class="botdzialawrapper">
                <h1 class="heading-4">Bot działa</h1>
                <p class="paragraph">AI przeanalizuje Twoje wiadomości i podsumuje koszty. Komendy:</p>
                <div class="komendy">
                  <div class="komenda">Proszę o podsumowanie lub /podsumowanie</div>
                  <div class="opis">- otrzymasz podsumowanie wydatków</div>
                </div>
                <div class="komendy">
                  <div class="komenda">Proszę o link lub /link</div>
                  <div class="opis">- otrzymasz link do podsumowania</div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const supabase = window.supabase.createClient(
        'https://vptpascqhmpmgnufevks.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZwdHBhc2NxaG1wbWdudWZldmtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc2NTcwNDEsImV4cCI6MjA2MzIzMzA0MX0.5Vtk65gjiUG0VrBqbukwikF02SX5z55xV-Ag3U4CGp0'
      );

      const { data: { session } } = await supabase.auth.getSession();

      if (!session || !session.user) {
        alert("Musisz być zalogowany.");
        window.location.href = "/";
        return;
      }

      const user = session.user;

      const { data, error: fetchError } = await supabase
        .from("users_config")
        .select("telegram_id")
        .eq("id", user.id)
        .single();

      const configStep2 = document.querySelector(".config-step-2");
      const configStep3 = document.querySelector(".config-step-3");

      if (data && data.telegram_id) {
        configStep2.style.display = "none";
        configStep3.style.display = "block";
      } else {
        configStep2.style.display = "block";
        configStep3.style.display = "none";

        const botUsername = "Persxfinance_bot";
        const tgUrl = `https://t.me/${botUsername}?start=${user.id}`;
        const btn = document.getElementById("tg-button");

        if (btn) {
          btn.href = tgUrl;
          btn.addEventListener("click", () => {
            configStep2.style.display = "none";
            configStep3.style.display = "block";
          });
        }
      }
    });
  </script>
</body>

</html>